runConfig:
  runtime: nodejs20

  # Root directory points to backend (where package.json is)
  rootDirectory: backend

  # VPC Access Configuration for Cloud SQL Private IP
  vpcAccess:
    egress: PRIVATE_RANGES_ONLY
    networkInterfaces:
      - network: default
        subnetwork: default

  # Build configuration
  build:
    # Build backend TypeScript
    - npm run build
    # Install frontend dependencies and build
    - npm install --prefix ../frontend
    - npm run build --prefix ../frontend

  # Environment variables (will be configured in Firebase Console)
  env:
    - variable: NODE_ENV
      value: production
    - variable: PORT
      value: "8080"
    - variable: DATABASE_URL
      secret: DATABASE_URL
    - variable: GITHUB_ORG
      value: risa-labs-inc
    - variable: GITHUB_PROJECT_NUMBER
      value: "3"
    - variable: POLLING_CRON_SCHEDULE
      value: "0 * * * *"
    - variable: LOG_LEVEL
      value: info
